#! /usr/bin/env nix-shell
#! nix-shell -i bash -p openssl

names=(
    xfix.pw
    www.xfix.pw
    showdown.xfix.pw
    nc.xfix.pw
    i.xfix.pw
    pastebin.run
    www.pastebin.run
    borowski.pw
    www.borowski.pw
)

openssl req -new -key server.key -out server.csr -subj "/CN=xfix.pw"
openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -CAserial ca.srl -CAcreateserial -out server.crt -extfile <(
    echo -n subjectAltName=
    comma=
    for name in "${names[@]}"
    do
        echo -n "${comma}DNS:$name"
        comma=","
    done
)
rm server.csr
cat {server,ca}.crt > full.pem
